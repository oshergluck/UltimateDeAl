import{cS as B,cX as Q,cL as e,gt as Y,cY as i,cN as o,cW as K,cT as j,c$ as H,cU as G,cV as X,g0 as A,cK as s,d7 as R,d6 as t,d0 as m,cM as b,dg as z,d2 as v,d8 as J,gu as Z,gn as E,go as T,dI as _,cR as O,di as ee,gv as ne,g8 as te}from"./index.a890a1de.js";import{o as re,u as ie,a as oe}from"./useInAppWalletLocale.0e8a4028.js";import{preAuthenticate as F}from"./index.7829194e.js";import{h as ae}from"./passkeys.567f9269.js";const N=B({animation:`${Q} 0.15s ease-in`});function ce(n){return e(le,{children:e(Y,{onComplete:()=>{n.onEnter()},maxLength:6,value:n.value,render:({slots:a})=>e(i,{flex:"row",gap:"xs",center:"both",children:a.map((g,c)=>e(se,{...g,isInvalid:n.isInvalid},c))}),onChange:a=>{n.setValue(a)}})})}const le=B({"& input":{maxWidth:"100%"}});function se(n){return o(he,{"data-active":n.isActive,"data-error":n.isInvalid,children:[n.char!==null&&e("div",{children:n.char}),n.hasFakeCaret&&e(ue,{})]})}const de=K`
  0%, 100% {
    opacity: 0;
  },
  50% {
    opacity: 1;
  }
  `,ue=B(()=>{const n=j();return{position:"absolute",pointerEvents:"none",inset:0,display:"flex",alignItems:"center",justifyContent:"center",animation:`${de} 1s infinite`,"&::before":{content:"''",display:"block",width:"1.5px",height:"1em",backgroundColor:n.colors.primaryText}}}),he=B(()=>{const n=j();return{position:"relative",width:"40px",height:"40px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:H.md,padding:G.xs,boxSizing:"border-box",transition:"color 200ms ease",border:`2px solid ${n.colors.borderColor}`,"&[data-active='true']":{borderColor:n.colors.accentText},color:n.colors.primaryText,borderRadius:X.lg,"&[data-error='true']":{borderColor:n.colors.danger}}});function ge(n){const{wallet:a,done:g,goBack:c,userInfo:r}=n,{client:d,chain:u,connectModal:l}=A(),f=l.size==="wide",x=n.locale,[p,W]=s.exports.useState(""),[L,k]=s.exports.useState("idle"),[y,S]=s.exports.useState("sending"),[w]=s.exports.useState("base"),I=s.exports.useCallback(async()=>{W(""),k("idle"),S("sending");try{if("email"in r){const h=await F({email:r.email,strategy:"email",client:d});S(h)}else if("phone"in r){const h=await F({phoneNumber:r.phone,strategy:"phone",client:d});S(h)}else throw new Error("Invalid userInfo")}catch(h){console.error(h),k("idle"),S("error")}},[d,r]);async function P(h){if("email"in r)await a.connect({chain:u,strategy:"email",email:r.email,verificationCode:h,client:d}),await E("email",T);else if("phone"in r)await a.connect({chain:u,strategy:"phone",phoneNumber:r.phone,verificationCode:h,client:d}),await E("phone",T);else throw new Error("Invalid userInfo")}const D=async h=>{if(!(typeof y!="object"||h.length!==6)&&(k("idle"),typeof y=="object"&&!!a))try{if(k("verifying"),y.recoveryShareManagement==="USER_MANAGED"&&(y.isNewUser||y.isNewDevice))if(y.isNewUser)try{await P(h)}catch(C){if(!(C instanceof Error&&C.message.includes("encryption key")))throw C}else try{await P(h)}catch(C){if(!(C instanceof Error&&C.message.includes("encryption key")))throw C}else await P(h),g();k("valid")}catch(M){M instanceof Error&&M?.message?.includes("PAYMENT_METHOD_REQUIRED")?k("payment_required"):k("invalid"),console.error("Authentication Error",M)}},U=s.exports.useRef(!1);return s.exports.useEffect(()=>{U.current||(U.current=!0,I())},[I]),w==="base"?o(i,{fullHeight:!0,flex:"column",animate:"fadein",children:[e(i,{p:"lg",children:e(R,{title:x.signIn,onBack:c})}),e(i,{expand:!0,flex:"column",center:"y",children:o("form",{onSubmit:h=>{h.preventDefault()},children:[o(i,{flex:"column",center:"x",px:"lg",children:[!f&&e(t,{y:"xl"}),e(m,{children:x.emailLoginScreen.enterCodeSendTo}),e(t,{y:"sm"}),e(m,{color:"primaryText",children:"email"in r?r.email:r.phone}),e(t,{y:"xl"})]}),e(ce,{isInvalid:L==="invalid",digits:6,value:p,setValue:h=>{W(h),k("idle")},onEnter:()=>{D(p)}}),L==="invalid"&&o(N,{children:[e(t,{y:"md"}),e(m,{size:"sm",color:"danger",center:!0,children:x.emailLoginScreen.invalidCode})]}),L==="payment_required"&&o(N,{children:[e(t,{y:"md"}),e(m,{size:"sm",color:"danger",center:!0,children:x.maxAccountsExceeded})]}),e(t,{y:"xl"}),e(i,{px:f?"xxl":"lg",children:L==="verifying"?e(b,{children:e(i,{flex:"row",center:"x",animate:"fadein",children:e(z,{size:"lg",color:"accentText"})})}):e(i,{animate:"fadein",children:e(v,{onClick:()=>D(p),variant:"accent",type:"submit",style:{width:"100%"},children:x.emailLoginScreen.verify})},"btn-container")}),e(t,{y:"xl"}),!f&&e(J,{}),o(i,{p:f?void 0:"lg",children:[y==="error"&&e(b,{children:e(m,{size:"sm",center:!0,color:"danger",children:x.emailLoginScreen.failedToSendCode})}),y==="sending"&&o(i,{flex:"row",center:"both",gap:"xs",style:{textAlign:"center"},children:[e(m,{size:"sm",children:x.emailLoginScreen.sendingCode}),e(z,{size:"xs",color:"secondaryText"})]}),typeof y=="object"&&e(fe,{onClick:I,type:"button",children:x.emailLoginScreen.resendCode})]})]})})]}):null}const fe=Z(()=>{const n=j();return{all:"unset",color:n.colors.accentText,fontSize:H.sm,cursor:"pointer",textAlign:"center",fontWeight:500,width:"100%","&:hover":{color:n.colors.primaryText}}}),$=n=>o("svg",{width:n.size,height:n.size,viewBox:"0 0 36 36",fill:"none","aria-hidden":"true",children:[e("path",{d:"M18.0001 15C17.2045 15 16.4414 15.3161 15.8788 15.8787C15.3162 16.4413 15.0001 17.2044 15.0001 18C15.0001 19.53 14.8501 21.765 14.6101 24",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M21.0002 19.6801C21.0002 23.2501 21.0002 29.2501 19.5002 33.0001",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M25.9348 31.53C26.1148 30.63 26.5798 28.08 26.6848 27",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M2.99976 18C2.99976 14.8518 3.99032 11.7833 5.83112 9.22935C7.67193 6.67536 10.2697 4.76531 13.2563 3.76975C16.243 2.77419 19.4672 2.74359 22.4723 3.6823C25.4773 4.621 28.1108 6.48141 29.9998 9",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M2.99976 24H3.01628",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M32.7 24C33 21 32.8965 15.969 32.7 15",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M7.49976 29.25C8.24976 27 8.99976 22.5 8.99976 18C8.99824 16.9783 9.17071 15.9638 9.50976 15",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M12.9751 33C13.2901 32.01 13.6501 31.02 13.8301 30",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e("path",{d:"M13.5 10.2C14.8686 9.40988 16.4211 8.99401 18.0014 8.99426C19.5818 8.99452 21.1342 9.41088 22.5025 10.2015C23.8708 10.9921 25.0069 12.129 25.7964 13.498C26.5859 14.867 27.001 16.4197 27 18V21",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})]});function xe(n){const{client:a,connectModal:g,chain:c}=A(),{wallet:r,done:d}=n,[u,l]=s.exports.useState("loading"),f=s.exports.useRef(!1);return s.exports.useEffect(()=>{f.current||(f.current=!0,ae(a).then(x=>{l(x?"login":"select")}).catch(()=>{l("select")}))},[a]),o(i,{animate:"fadein",fullHeight:!0,flex:"column",children:[e(i,{p:"lg",children:e(R,{title:"Passkey",onBack:n.onBack})}),e(i,{px:g.size==="wide"?"xxl":"lg",expand:!0,flex:"column",center:"y",children:o("div",{children:[u==="loading"&&o(b,{children:[e(_,{}),e(t,{y:"xxl"})]}),u==="select"&&e(pe,{onSignin:()=>{l("login")},onSignup:()=>{l("signup")}}),u==="login"&&e(ye,{wallet:r,client:a,done:d,onCreate:()=>{l("signup")},chain:c}),u==="signup"&&e(me,{wallet:r,client:a,done:d,chain:c})]})})]})}function ye(n){const{wallet:a,done:g,client:c,chain:r}=n,[d,u]=s.exports.useState("loading");async function l(){u("loading");try{await a.connect({client:c,strategy:"passkey",type:"sign-in",chain:r}),await E("passkey",T),g()}catch{u("error")}}const f=s.exports.useRef(!1);return s.exports.useEffect(()=>{f.current||(f.current=!0,l())}),d==="loading"?e(q,{title:"Requesting Passkey",subtitle:"A pop-up prompt will appear to sign-in and verify your passkey"}):d==="error"?o(b,{children:[e(V,{onTryAgain:l,title:"Failed to Login"}),e(t,{y:"sm"}),e(v,{variant:"outline",fullWidth:!0,onClick:n.onCreate,children:"Create a new Passkey"}),e(t,{y:"lg"})]}):null}function me(n){const{wallet:a,done:g,client:c,chain:r}=n,[d,u]=s.exports.useState("loading");async function l(){u("loading");try{await a.connect({client:c,strategy:"passkey",type:"sign-up",chain:r}),await E("passkey",T),g()}catch{u("error")}}const f=s.exports.useRef(!1);return s.exports.useEffect(()=>{f.current||(f.current=!0,l())}),d==="loading"?e(q,{title:"Creating Passkey",subtitle:"A pop-up prompt will appear to sign-in and verify your passkey"}):d==="error"?o(b,{children:[e(V,{onTryAgain:l,title:"Failed to create passkey"}),e(t,{y:"lg"})]}):null}function pe(n){return o(i,{children:[e(t,{y:"xxl"}),e(i,{flex:"row",center:"x",color:"accentText",children:e($,{size:O["4xl"]})}),e(t,{y:"xl"}),e(t,{y:"xxl"}),e(v,{variant:"accent",onClick:n.onSignup,fullWidth:!0,children:"Create a Passkey"}),e(t,{y:"sm"}),e(v,{variant:"outline",onClick:n.onSignin,fullWidth:!0,children:"I have a Passkey"}),e(t,{y:"lg"})]})}function V(n){return o(i,{animate:"fadein",children:[e(t,{y:"xxl"}),e(i,{flex:"row",center:"x",children:e(ee,{size:O["3xl"]})}),e(t,{y:"lg"}),e(m,{center:!0,color:"primaryText",size:"lg",children:n.title}),e(t,{y:"xl"}),e(t,{y:"xxl"}),e(v,{variant:"accent",fullWidth:!0,onClick:n.onTryAgain,children:"Try Again"})]})}function q(n){return o(i,{animate:"fadein",children:[e(t,{y:"xxl"}),o(i,{flex:"row",center:"x",style:{position:"relative"},children:[e(z,{size:"4xl",color:"accentText"}),e(i,{color:"accentText",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e($,{size:O.xxl})})]}),e(t,{y:"xl"}),e(m,{center:!0,color:"primaryText",size:"lg",children:n.title}),e(t,{y:"md"}),e(m,{multiline:!0,center:!0,children:n.subtitle}),e(t,{y:"xxl"}),e(t,{y:"xxl"})]})}function ke(n){const a=n.locale,g=a.socialLoginScreen,c=j(),{connectModal:r}=A(),[d,u]=s.exports.useState(void 0),{done:l,wallet:f}=n,[x,p]=s.exports.useState("connecting"),{client:W,chain:L}=A(),k=async()=>{try{const w=re(n.socialAuth,c);if(!w)throw new Error(`Failed to open ${n.socialAuth} login window`);p("connecting"),await f.connect({chain:L,strategy:n.socialAuth,openedWindow:w,closeOpenedWindow:I=>{I.close()},client:W}),await E(n.socialAuth,T),p("connected"),l()}catch(w){p("error"),w instanceof Error&&w?.message?.includes("PAYMENT_METHOD_REQUIRED")&&u(a.maxAccountsExceeded),console.error(`Error sign in with ${n.socialAuth}`,w)}},y=n.state?.socialLogin,S=s.exports.useRef(!1);return s.exports.useEffect(()=>{S.current||y&&(S.current=!0,p("connecting"),y.connectionPromise.then(()=>{l(),p("connected")}).catch(()=>{p("error")}))},[l,y]),e(i,{animate:"fadein",flex:"column",fullHeight:!0,children:o(i,{flex:"column",expand:!0,p:"lg",style:{paddingBottom:0},children:[n.goBack&&e(R,{title:g.title,onBack:n.goBack}),r.size==="compact"?e(t,{y:"xl"}):null,o(i,{flex:"column",center:"both",expand:!0,style:{textAlign:"center",minHeight:"250px"},children:[x!=="error"&&o(i,{animate:"fadein",children:[e(m,{color:"primaryText",center:!0,multiline:!0,style:{maxWidth:"250px"},children:g.instruction}),e(t,{y:"xl"}),e(i,{center:"x",flex:"row",children:e(z,{size:"lg",color:"accentText"})}),e(t,{y:"xxl"})]}),x==="error"&&o(i,{animate:"fadein",children:[e(m,{color:"danger",children:g.failed}),d&&e(m,{color:"danger",children:d}),e(t,{y:"lg"}),e(v,{variant:"primary",onClick:k,children:g.retry}),e(t,{y:"xxl"})]})]})]})})}function ve(n){const a=ne(),g=te(),c=a,r=ie(),{connectModal:d}=A();if(!r.data)return e(_,{});const u=d.size==="compact"?n.goBack:()=>{g({})},l=c?.emailLogin?{email:c.emailLogin}:c?.phoneLogin?{phone:c.phoneLogin}:void 0;return l?e(ge,{userInfo:l,locale:r.data,done:n.done,goBack:u,wallet:n.wallet}):c?.passkeyLogin?e(xe,{wallet:n.wallet,done:n.done,onBack:u}):c?.socialLogin?e(ke,{socialAuth:c.socialLogin.type,locale:r.data,done:n.done,goBack:u,wallet:n.wallet,state:c}):e(oe,{select:()=>{},locale:r.data,done:n.done,goBack:n.goBack,wallet:n.wallet})}export{ve as default};
