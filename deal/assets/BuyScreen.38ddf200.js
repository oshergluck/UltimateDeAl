import{cF as pe,cG as Re,cH as se,cI as me,cJ as Ie,cK as g,cL as t,cM as W,cN as r,cO as De,cP as Me,cQ as ze,cR as B,cS as xe,cT as j,cU as F,cV as U,cW as Pe,cX as Le,cY as d,cZ as Ne,c_ as D,c$ as p,d0 as y,d1 as qe,d2 as R,d3 as ee,d4 as O,d5 as G,d6 as l,d7 as te,d8 as Z,d9 as Oe,da as _e,db as Qe,dc as Ve,dd as $e,de as Ue,df as je,dg as ne,dh as He,di as Ye,dj as Ge,dk as Ke,dl as de,dm as ge,dn as Je,dp as Ze,dq as K,dr as Xe,ds as M,dt as z,du as et,dv as Se,dw as tt,dx as H,dy as nt,dz as oe,dA as ot,dB as X,dC as Y,dD as we,dE as Ce,dF as it,dG as at,dH as rt,dI as ct,dJ as st,dK as dt,dL as le,dM as lt,dN as ut,dO as ht,dP as ft,dQ as yt,dR as mt,dS as xt}from"./index.a890a1de.js";async function gt(e){try{const n=new URLSearchParams({toAddress:e.toAddress,fromCurrencySymbol:e.fromCurrencySymbol,toChainId:e.toChainId.toString(),toTokenAddress:e.toTokenAddress.toLowerCase()});e.fromAmount&&n.append("fromAmount",e.fromAmount),e.toAmount&&n.append("toAmount",e.toAmount),e.maxSlippageBPS&&n.append("maxSlippageBPS",e.maxSlippageBPS.toString()),e.isTestMode&&n.append("isTestMode",e.isTestMode.toString());const a=n.toString(),o=`${pe()}?${a}`,i=await Re(e.client)(o);if(!i.ok){const c=await i.json();throw c&&"error"in c?c:new Error(`HTTP error! status: ${i.status}`)}return(await i.json()).result}catch(n){throw console.error("Fetch error:",n),n}}function Te(e){const n=e.toToken.chainId===e.onRampToken.token.chainId,a=se(e.toToken.tokenAddress)===se(e.onRampToken.token.tokenAddress);return!(n&&a)}function St(e,n){return me({...n,queryKey:["buyWithCryptoQuote",e],queryFn:()=>{if(!e)throw new Error("Swap params are required");return Ie(e)},enabled:!!e,retry(a,o){return!(a>3||o.message.includes("Minimum purchase"))}})}function wt(e,n){return me({...n,queryKey:["useBuyWithFiatQuote",e],queryFn:async()=>{if(!e)throw new Error("No params provided");return gt(e)},enabled:!!e,retry(a,o){if(a>3)return!1;try{if(o.error.code==="MINIMUM_PURCHASE_AMOUNT")return!1}catch{return!0}return!0}})}const Ct=g.exports.forwardRef(function(n,a){return t(W,{children:r(Tt,{ref:a,children:[t(De,{children:t(Me,{type:"button","aria-label":"Close",onClick:n.close,children:t(ze,{width:B.md,height:B.md,style:{color:"inherit"}})})}),n.children]})})}),Tt=xe(()=>{const e=j();return{zIndex:1e4,padding:F.lg,borderTopLeftRadius:U.xl,borderTopRightRadius:U.xl,background:e.colors.modalBg,position:"absolute",bottom:0,left:0,right:0,animation:`${kt} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1)`,borderTop:`1px solid ${e.colors.borderColor}`}}),kt=Pe`
  from {
    opacity: 0;
    transform: translateY(100px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,bt=xe(()=>({backgroundColor:j().colors.modalOverlayBg,zIndex:9999,position:"absolute",inset:0,animation:`${Le} 400ms cubic-bezier(0.16, 1, 0.3, 1)`}));function Bt(){const e=g.exports.useRef(null),n=g.exports.useRef(null);return{drawerRef:e,drawerOverlayRef:n,onClose:o=>{if(e.current){const i={easing:"cubic-bezier(0.175, 0.885, 0.32, 1.1)",fill:"forwards",duration:300},c=e.current.animate([{transform:"translateY(100%)",opacity:0}],i);n.current?.animate([{opacity:0}],i),c.onfinish=o}else o()}}}function ke(e){const{estimatedSeconds:n,quoteIsLoading:a}=e;return r(d,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{borderRadius:U.md,borderTopLeftRadius:0,borderTopRightRadius:0,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid"},children:[r(d,{flex:"row",center:"y",gap:"xxs",color:"accentText",p:"sm",children:[t(Ne,{width:B.sm,height:B.sm}),a?t(D,{height:p.xs,width:"50px",color:"borderColor"}):t(y,{size:"xs",color:"secondaryText",children:n!==void 0?`~${qe(n)}`:"--"})]}),r(R,{variant:"ghost",onClick:e.onViewFees,gap:"xs",children:[t(d,{color:"accentText",flex:"row",center:"both",children:t(Ft,{size:B.sm})}),t(y,{size:"xs",color:"secondaryText",children:"View Fees"})]})]})}const Ft=e=>r("svg",{width:e.size,height:e.size,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t("path",{d:"M9.5 1.5H2.5C1.94772 1.5 1.5 1.94772 1.5 2.5V9.5C1.5 10.0523 1.94772 10.5 2.5 10.5H9.5C10.0523 10.5 10.5 10.0523 10.5 9.5V2.5C10.5 1.94772 10.0523 1.5 9.5 1.5Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),t("path",{d:"M4.5 7.5L7.5 4.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]});function At(e){return r(d,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:U.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",alignItems:"center"},children:[r(Et,{variant:"ghost",onClick:e.onSelectCurrency,style:{minHeight:"64px",justifyContent:"flex-start",minWidth:"50%"},gap:"sm",children:[t(e.currency.icon,{size:B.md}),r(d,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[t(y,{color:"primaryText",children:e.currency.shorthand}),t(ee,{width:B.sm,height:B.sm})]})]}),t("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:F.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:F.sm},children:e.isLoading?t(D,{width:"100px",height:p.lg}):t(y,{size:"lg",color:e.value?"primaryText":"secondaryText",children:e.value?`${O(Number(e.value),4)}`:"--"})})]})}const Et=G(R)(()=>({"&[disabled]:hover":{borderColor:"transparent"}}));function Wt(e){return r("div",{children:[t(y,{size:"sm",children:"Pay with "}),t(l,{y:"xs"}),r(d,{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gridGap:F.sm},children:[t(ue,{isChecked:e.selected==="creditCard",variant:"outline",onClick:()=>{e.onSelect("creditCard")},children:"Credit Card"}),t(ue,{isChecked:e.selected==="crypto",variant:"outline",onClick:()=>{e.onSelect("crypto")},children:"Crypto"})]})]})}const ue=G(R)(e=>{const n=j();return{fontSize:p.sm,borderColor:e.isChecked?n.colors.accentText:n.colors.borderColor,"&:hover":{borderColor:e.isChecked?n.colors.accentText:n.colors.secondaryText},gap:F.xs,paddingInline:F.xxs,paddingBlock:F.sm,width:"100%"}});function vt(e){return r(d,{children:[t(d,{p:"lg",children:t(te,{title:"Select Currency",onBack:e.onBack})}),t(Z,{}),t(l,{y:"lg"}),t(d,{flex:"column",gap:"xs",px:"lg",children:Oe.map(n=>r(pt,{fullWidth:!0,variant:"secondary",onClick:()=>e.onSelect(n),gap:"sm",children:[t(n.icon,{size:B.lg}),r(d,{flex:"column",gap:"xxs",children:[t(y,{color:"primaryText",children:n.shorthand}),t(y,{size:"sm",children:n.name})]})]},n.shorthand))}),t(l,{y:"lg"})]})}const pt=G(R)(()=>{const e=j();return{background:e.colors.tertiaryBg,justifyContent:"flex-start",gap:F.sm,padding:F.sm,"&:hover":{background:e.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease"}});function be(e,n){const i=(window.innerHeight-750)/2,c=(window.innerWidth-500)/2;return window.open(`${e}&theme=${n}`,"thirdweb Pay",`width=${500}, height=${750}, top=${i}, left=${c}`)}function Rt(e){const n=_e(),{openedWindow:a}=e,o=Qe({intentId:e.intentId,client:e.client});let i="loading";o.data?.status==="ON_RAMP_TRANSFER_FAILED"||o.data?.status==="PAYMENT_FAILED"?i="failed":o.data?.status==="CRYPTO_SWAP_FALLBACK"?i="partialSuccess":o.data?.status==="ON_RAMP_TRANSFER_COMPLETED"&&(i="completed"),g.exports.useEffect(()=>{!a||!o.data||(o.data?.status==="CRYPTO_SWAP_REQUIRED"||o.data?.status==="ON_RAMP_TRANSFER_COMPLETED")&&a.close()},[o.data,a]);const c=g.exports.useRef(!1);return g.exports.useEffect(()=>{!c.current&&o.data?.status==="ON_RAMP_TRANSFER_COMPLETED"&&(c.current=!0,Ve(n))},[o.data,n]),g.exports.useEffect(()=>{o.data?.status==="CRYPTO_SWAP_REQUIRED"&&e.onShowSwapFlow(o.data)},[o.data,e.onShowSwapFlow]),r(d,{p:"lg",children:[t(te,{title:"Buy",onBack:e.onBack}),e.hasTwoSteps&&r(W,{children:[t(l,{y:"lg"}),t($e,{steps:2,currentStep:1}),t(l,{y:"sm"}),r(y,{size:"xs",children:["Step 1 of 2 - Buying ",e.quote.onRampToken.token.symbol," with"," ",e.quote.fromCurrencyWithFees.currencySymbol]})]}),t(It,{uiStatus:i,onDone:e.onDone,fiatStatus:o.data,client:e.client,isBuyForTx:e.isBuyForTx,quote:e.quote,isEmbed:e.isEmbed})]})}function It(e){const{uiStatus:n}=e,a=e.fiatStatus?Ue(e.fiatStatus):void 0,o=e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"?e.fiatStatus:void 0,i=e.quote.onRampToken,c=t(je,{client:e.client,token:o?.source?{chainId:o.source.token.chainId,address:o.source.token.tokenAddress,symbol:o.source.token.symbol||"",amount:o.source.amount}:{chainId:i.token.chainId,address:i.token.tokenAddress,symbol:i.token.symbol,amount:i.amount},fiat:{amount:e.quote.fromCurrencyWithFees.amount,currencySymbol:e.quote.fromCurrencyWithFees.currencySymbol},statusMeta:o?.source&&a?{color:a?.color,text:a?.status,txHash:o.source.transactionHash}:void 0});return r(d,{children:[t(l,{y:"xl"}),n==="loading"&&r(W,{children:[t(l,{y:"md"}),t(d,{flex:"row",center:"x",children:t(ne,{size:"3xl",color:"accentText"})}),t(l,{y:"md"}),t(y,{color:"primaryText",size:"lg",center:!0,children:"Buy Pending"}),t(l,{y:"sm"}),!He()&&t(y,{center:!0,children:"Complete the purchase in popup"}),t(l,{y:"xxl"}),c]}),n==="failed"&&r(W,{children:[t(l,{y:"md"}),t(d,{flex:"row",center:"x",children:t(Ye,{size:B["3xl"]})}),t(l,{y:"lg"}),t(y,{color:"primaryText",size:"lg",center:!0,children:"Transaction Failed"}),t(l,{y:"xxl"}),c]}),n==="completed"&&r(W,{children:[t(l,{y:"md"}),t(d,{flex:"row",center:"x",color:"success",children:t(Ge,{width:B["3xl"],height:B["3xl"]})}),t(l,{y:"md"}),t(y,{color:"primaryText",size:"lg",center:!0,children:"Buy Complete"}),e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"&&r(W,{children:[t(l,{y:"xxl"}),c,t(l,{y:"sm"})]}),!e.isEmbed&&t(R,{variant:"accent",fullWidth:!0,onClick:e.onDone,children:e.isBuyForTx?"Continue Transaction":"Done"})]})]})}function Dt(e){const n=Te(e.quote),[a,o]=g.exports.useState(n?{id:"step-1"}:{id:"onramp-status"}),[i,c]=g.exports.useState(e.openedWindow);return a.id==="step-1"?t(Ke,{client:e.client,onBack:e.onBack,partialQuote:de(e.quote),step:1,onContinue:()=>{const u=be(e.quote.onRampLink,e.theme);ge({type:"fiat",intentId:e.quote.intentId}),c(u),o({id:"onramp-status"})}}):a.id==="onramp-status"?t(Rt,{client:e.client,intentId:e.quote.intentId,onBack:e.onBack,onViewPendingTx:e.onViewPendingTx,hasTwoSteps:n,openedWindow:i,quote:e.quote,onDone:e.onDone,onShowSwapFlow:u=>{o({id:"postonramp-swap",data:u})},isBuyForTx:e.isBuyForTx,isEmbed:e.isEmbed}):a.id==="postonramp-swap"?t(Je,{status:a.data,quote:de(e.quote),client:e.client,onBack:e.onBack,onViewPendingTx:e.onViewPendingTx,onDone:e.onDone,onSwapFlowStarted:()=>{},isBuyForTx:e.isBuyForTx,isEmbed:e.isEmbed}):null}function Mt(e){const{buyForTx:n,hasEditedAmount:a,isMainScreen:o,setTokenAmount:i,account:c}=e,u=!a&&o,f=!o,[m,w]=g.exports.useState(n?.cost);return g.exports.useEffect(()=>{if(!n||f)return;let h=!0;async function s(){if(!(!n||!h)){try{const T=await Ze(n.tx,c?.address);if(!h)return;if(w(T),u&&T>n.balance){const E=String(O(Number(K(T-n.balance)),4));i(E)}}catch{}await Xe(3e4),s()}}return s(),()=>{h=!1}},[n,u,i,f,c]),{amountNeeded:m}}function zt(e){const{payOptions:n,supportedDestinations:a,toChain:o,toToken:i,method:c,setMethod:u}=e;function f(){const E=a.find(S=>S.chain.id===o.id);if(!E)return{fiat:!0,swap:!0};const x=M(i)?z:i.address,b=E.tokens.find(S=>S.address.toLowerCase()===x.toLowerCase());return b?{fiat:b.buyWithFiatEnabled,swap:b.buyWithCryptoEnabled}:{fiat:!0,swap:!0}}const{fiat:m,swap:w}=f(),h=n.buyWithFiat!==!1&&m,s=n.buyWithCrypto!==!1&&w;return g.exports.useEffect(()=>{!h&&!s||(c==="creditCard"&&!h&&u("crypto"),c==="crypto"&&!s&&u("creditCard"))},[h,s,c,u]),{showPaymentSelection:h&&s}}const he=et({id:137,name:"Polygon",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorers:[{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}]});function Pt(e){const n=Se(),{payOptions:a,buyForTx:o,supportedDestinations:i}=e,c=a.prefillBuy?.amount||(o?String(O(Number(K(o.cost-o.balance)),4)):""),[u,f]=g.exports.useState(!1),[m,w]=g.exports.useState(c),h=tt(m,300),[s,T]=g.exports.useState(a.prefillBuy?.chain||o?.tx.chain||i.find(Q=>Q.chain.id===n?.id)?.chain||he),[E,x]=g.exports.useState(a.prefillBuy?.token||H),[b,S]=g.exports.useState(a.buyWithCrypto!==!1&&a.buyWithCrypto?.prefillSource?.chain||he),[C,I]=g.exports.useState(a.buyWithCrypto!==!1&&a.buyWithCrypto?.prefillSource?.token||H),[P,_]=g.exports.useState(nt);return{tokenAmount:m,setTokenAmount:w,hasEditedAmount:u,toChain:s,setToChain:T,deferredTokenAmount:h,fromChain:b,setFromChain:S,toToken:E,setToToken:x,fromToken:C,setFromToken:I,selectedCurrency:P,setHasEditedAmount:f,setSelectedCurrency:_}}function Lt(e){const n=oe(e.chain),a=()=>{let o=e.value.replace(".","").length;return e.value.includes(".")&&(o+=.3),`calc(${`${Math.max(1,o)}ch`} + 6px)`};return r(d,{children:[t("div",{onClick:o=>{o.currentTarget.querySelector("input")?.focus()},children:r(d,{flex:"row",center:"both",gap:"xs",style:{flexWrap:"nowrap"},children:[t(ot,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",placeholder:"0",type:"text","data-placeholder":e.value==="",value:e.value||"0",disabled:e.freezeAmount,onClick:o=>{e.value===""&&o.currentTarget.setSelectionRange(o.currentTarget.value.length,o.currentTarget.value.length)},onChange:o=>{let i=o.target.value;i.startsWith(".")&&(i=`0${i}`);const c=Number(i);Number.isNaN(c)||(i.startsWith("0")&&!i.startsWith("0.")?e.onChange(i.slice(1)):e.onChange(i))},style:{border:"none",fontSize:e.value.length>10?"26px":e.value.length>6?"34px":"50px",boxShadow:"none",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"right",width:a(),maxWidth:"calc(100% - 100px)"}}),t(X,{token:e.token,chain:e.chain,size:"lg",color:"secondaryText"})]})}),!e.hideTokenSelector&&r(W,{children:[t(l,{y:"sm"}),t(d,{flex:"row",center:"x",children:r(Nt,{variant:"secondary",fullWidth:!0,style:{fontSize:p.sm},gap:"xxs",onClick:e.onSelectToken,disabled:e.freezeChainAndToken,children:[r(d,{flex:"row",center:"y",gap:"sm",children:[t(Y,{token:e.token,chain:e.chain,size:"md",client:e.client}),r(d,{flex:"column",style:{gap:"4px"},children:[t(X,{token:e.token,chain:e.chain,size:"sm"}),n.data?.name?t(y,{size:"xs",color:"secondaryText",children:n.data.name}):t(D,{width:"90px",height:p.xs})]})]}),t(ee,{width:B.sm,height:B.sm,style:{marginLeft:"auto"}})]})})]})]})}const Nt=G(R)(()=>{const e=j();return{background:e.colors.tertiaryBg,border:`1px solid ${e.colors.borderColor}`,justifyContent:"flex-start",transition:"background 0.3s",padding:F.sm}});function qt(e){const n=oe(e.chain),a=we(),o=Ce({address:a?.address,chain:e.chain,tokenAddress:M(e.token)?void 0:e.token.address,client:e.client});return r(d,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:U.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",minHeight:"64px",alignItems:"center"},children:[r(R,{variant:"ghost",onClick:e.onSelectToken,gap:"sm",style:{paddingInline:F.sm,paddingBlock:F.sm,minWidth:"50%",justifyContent:"flex-start"},disabled:e.freezeChainAndTokenSelection,children:[t(Y,{token:e.token,chain:e.chain,size:"md",client:e.client}),r(d,{flex:"column",gap:"xxs",children:[r(d,{flex:"row",gap:"xs",center:"y",color:"primaryText",children:[t(X,{token:e.token,chain:e.chain,size:"sm"}),t(ee,{width:B.sm,height:B.sm})]}),n.data?.name?r(y,{size:"xs",children:[" ",n.data.name]}):t(D,{width:"90px",height:p.xs})]})]}),r("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:F.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:F.sm},children:[e.isLoading?t(D,{width:"120px",height:p.md,color:"borderColor"}):t(y,{size:"md",color:e.value?"primaryText":"secondaryText",style:{},children:O(Number(e.value),4)||"--"}),r(d,{flex:"row",gap:"xxs",center:"y",color:"secondaryText",children:[t(it,{size:p.xs}),o.data?t(y,{size:"xs",color:"secondaryText",weight:500,children:at(o.data,!0)}):t(D,{width:"70px",height:p.xs})]})]})]})}function jt(e){const n=rt(e.client);return n.data?t(_t,{...e,onViewPendingTx:e.onViewPendingTx,supportedDestinations:n.data,buyForTx:e.buyForTx}):t(ct,{})}function Ot(e){const{payOptions:n}=e,[a,o]=g.exports.useState(n.buyWithCrypto===!1?"creditCard":n.buyWithFiat===!1?"crypto":"creditCard"),[i,c]=g.exports.useState({type:"main"}),[u,f]=g.exports.useState(),{drawerRef:m,drawerOverlayRef:w,onClose:h}=Bt();function s(){h(()=>{f(void 0)})}function T(){c({type:"main"})}return{method:a,setMethod:o,screen:i,setScreen:c,drawerScreen:u,setDrawerScreen:f,drawerRef:m,drawerOverlayRef:w,closeDrawer:s,showMainScreen:T}}function _t(e){const{client:n,supportedDestinations:a,connectLocale:o,payOptions:i,buyForTx:c}=e,u=we(),f=Se();st(a.map(A=>A.chain)||[],50);const{method:m,setMethod:w,screen:h,setScreen:s,drawerScreen:T,setDrawerScreen:E,drawerRef:x,drawerOverlayRef:b,closeDrawer:S,showMainScreen:C}=Ot({payOptions:i}),{tokenAmount:I,setTokenAmount:P,setHasEditedAmount:_,hasEditedAmount:Q,toChain:v,setToChain:L,deferredTokenAmount:V,fromChain:$,setFromChain:ie,toToken:N,setToToken:Be,fromToken:Fe,setFromToken:Ae,selectedCurrency:Ee,setSelectedCurrency:We}=Pt({payOptions:i,buyForTx:c,supportedDestinations:a}),{amountNeeded:ae}=Mt({setTokenAmount:P,buyForTx:c,hasEditedAmount:Q,isMainScreen:h.type==="main",account:u}),J=f&&I,q=dt({client:e.client,destinationChainId:v.id,destinationTokenAddress:M(N)?z:N.address}),ve=g.exports.useMemo(()=>fe(a,i,e.supportedTokens),[e.supportedTokens,a,i]),re=g.exports.useMemo(()=>{if(!!q.data)return fe(q.data,i,e.supportedTokens)},[e.supportedTokens,q.data,i]),{showPaymentSelection:ce}=zt({payOptions:i,supportedDestinations:a,toChain:v,toToken:N,method:m,setMethod:w});if(h.type==="node")return h.node;if(h.type==="select-currency")return t(vt,{onSelect:A=>{C(),We(A)},onBack:C});if(h.type==="screen-id"&&h.name==="select-to-token"){const A=a.map(k=>k.chain);return i.prefillBuy?.allowEdits?.token===!1?t(ye,{chains:A,client:e.client,connectLocale:e.connectLocale,setChain:L,showMainScreen:C}):t(le,{onBack:C,tokenList:((v?.id?ve[v.id]:void 0)||[]).filter(k=>k.address!==z),onTokenSelect:k=>{Be(k),C()},chain:v,chainSelection:i.prefillBuy?.allowEdits?.chain!==!1?{chains:A,select:k=>{L(k)}}:void 0,connectLocale:o,client:n})}if(h.type==="screen-id"&&h.name==="select-from-token"&&q.data&&re){const A=q.data.map(k=>k.chain);return i.buyWithCrypto!==!1&&i.buyWithCrypto?.prefillSource?.allowEdits?.token===!1?t(ye,{chains:A,client:e.client,connectLocale:e.connectLocale,setChain:ie,showMainScreen:C}):t(le,{onBack:C,tokenList:(($?.id?re[$.id]:void 0)||[]).filter(k=>k.address!==z),onTokenSelect:k=>{Ae(k),s({type:"main"})},chain:$,chainSelection:i.buyWithCrypto!==!1&&i.buyWithCrypto?.prefillSource?.allowEdits?.chain!==!1?{chains:q.data.map(k=>k.chain),select:k=>ie(k)}:void 0,connectLocale:o,client:n})}return t(d,{animate:"fadein",children:r("div",{onClick:A=>{T&&x.current&&!x.current.contains(A.target)&&(A.preventDefault(),A.stopPropagation(),S())},children:[T&&r(W,{children:[t(bt,{ref:b}),t(Ct,{ref:x,close:S,children:t(lt,{children:T})})]}),r(d,{p:"lg",style:{paddingBottom:0},children:[t(te,{title:e.buyForTx?`Not enough ${e.buyForTx.tokenSymbol}`:"Buy",onBack:e.onBack}),t(l,{y:"lg"}),!J&&t(l,{y:"xl"}),ae&&e.buyForTx?t($t,{amountNeeded:String(O(Number(K(ae)),4)),buyForTx:e.buyForTx,client:n}):null,t(Lt,{value:I,onChange:async A=>{_(!0),P(A)},freezeAmount:i.prefillBuy?.allowEdits?.amount===!1,freezeChainAndToken:i.prefillBuy?.allowEdits?.chain===!1&&i.prefillBuy?.allowEdits?.token===!1,token:N,chain:v,onSelectToken:()=>{s({type:"screen-id",name:"select-to-token"})},client:e.client,hideTokenSelector:!!e.buyForTx})]}),ce?t(l,{y:"lg"}):t(l,{y:"md"}),J&&r(W,{children:[ce&&r(d,{px:"lg",children:[t(Wt,{selected:m,onSelect:w}),t(l,{y:"md"})]}),m==="crypto"&&u&&f&&t(Qt,{...e,setScreen:s,setDrawerScreen:E,tokenAmount:V,toChain:v,toToken:N,fromChain:$,fromToken:Fe,showFromTokenSelector:()=>{s({type:"screen-id",name:"select-from-token"})},account:u,activeChain:f}),m==="creditCard"&&u&&t(Vt,{...e,setScreen:s,setDrawerScreen:E,tokenAmount:V,toChain:v,toToken:N,closeDrawer:S,selectedCurrency:Ee,showCurrencySelector:()=>{s({type:"select-currency"})},account:u}),t(l,{y:"sm"})]}),r(d,{px:"lg",flex:"column",gap:"sm",children:[!J&&t(W,{children:!u&&e.connectButton?t("div",{children:e.connectButton}):t(R,{variant:"accent",fullWidth:!0,disabled:!0,"data-disable":!0,children:"Continue"})}),u&&t(R,{variant:"outline",fullWidth:!0,style:{padding:F.xs,fontSize:p.sm},onClick:e.onViewPendingTx,children:"View all transactions"})]}),t(l,{y:"lg"})]})})}function Qt(e){const{setDrawerScreen:n,setScreen:a,account:o,client:i,toChain:c,tokenAmount:u,toToken:f,fromChain:m,fromToken:w,showFromTokenSelector:h,payOptions:s}=e,T=Ce({address:o.address,chain:m,tokenAddress:M(w)?void 0:w.address,client:i}),E=u&&!(m.id===c.id&&w===f)?{fromAddress:o.address,fromChainId:m.id,fromTokenAddress:M(w)?z:w.address,toChainId:c.id,toTokenAddress:M(f)?z:f.address,toAmount:u,client:i}:void 0,x=St(E,{staleTime:30*1e3,refetchInterval:30*1e3,gcTime:30*1e3}),b=x.data?.swapDetails.fromAmount,S=!!b&&!!T.data&&Number(T.data.displayValue)<Number(b),C=!x.data||S,I=e.activeChain.id!==m.id;function P(L){const V="Unable to get price quote";try{return L instanceof Error&&L.message.includes("Minimum")?L.message.replace("Fetch failed: Error: ",""):V}catch{return V}}function _(){!x.data||a({type:"node",node:t(yt,{isBuyForTx:!!e.buyForTx,isEmbed:e.isEmbed,client:i,onBack:()=>{a({type:"main"})},buyWithCryptoQuote:x.data,account:o,onViewPendingTx:e.onViewPendingTx,isFiatFlow:!1,onDone:e.onDone,onTryAgain:()=>{a({type:"main"}),x.refetch()}})})}function Q(){!x.data||n(r("div",{children:[t(y,{size:"lg",color:"primaryText",children:"Fees"}),t(l,{y:"lg"}),t(mt,{quote:x.data,align:"left"})]}))}const v=s.buyWithCrypto!==!1?s.buyWithCrypto?.prefillSource:void 0;return r(d,{px:"lg",flex:"column",gap:"md",children:[r("div",{children:[t(qt,{value:b||"",onSelectToken:h,chain:m,token:w,isLoading:x.isLoading&&!b,client:i,freezeChainAndTokenSelection:v?.allowEdits?.chain===!1&&v?.allowEdits?.token===!1}),t(ke,{quoteIsLoading:x.isLoading,estimatedSeconds:x.data?.swapDetails.estimated.durationSeconds,onViewFees:Q})]}),x.error&&t(y,{color:"danger",size:"sm",center:!0,children:P(x.error)}),I&&!x.isLoading&&!S&&!x.error?t(ut,{variant:"accent",fullWidth:!0,chain:m}):t(R,{variant:C?"outline":"accent",fullWidth:!0,"data-disabled":C,disabled:C,onClick:async()=>{C||_()},gap:"xs",children:S?t(y,{color:"danger",children:"Not Enough Funds"}):x.isLoading?r(W,{children:[t(ne,{size:"sm",color:"accentText"}),"Getting price quote"]}):"Continue"})]})}function Vt(e){const{toToken:n,tokenAmount:a,account:o,client:i,setScreen:c,setDrawerScreen:u,toChain:f,showCurrencySelector:m,selectedCurrency:w}=e,h=e.payOptions.buyWithFiat,s=wt(h!==!1&&a?{fromCurrencySymbol:w.shorthand,toChainId:f.id,toAddress:o.address,toTokenAddress:M(n)?z:n.address,toAmount:a,client:i,isTestMode:h?.testMode}:void 0);function T(){if(!s.data)return;const S=Te(s.data);let C=null;S||(C=be(s.data.onRampLink,typeof e.theme=="string"?e.theme:e.theme.type),ge({type:"fiat",intentId:s.data.intentId})),c({type:"node",node:t(Dt,{isBuyForTx:!!e.buyForTx,quote:s.data,onBack:()=>{c({type:"main"})},client:i,testMode:h!==!1&&h?.testMode||!1,theme:typeof e.theme=="string"?e.theme:e.theme.type,onViewPendingTx:e.onViewPendingTx,openedWindow:C,onDone:e.onDone,isEmbed:e.isEmbed})})}function E(){!s.data||u(r("div",{children:[t(y,{size:"lg",color:"primaryText",children:"Fees"}),t(l,{y:"lg"}),t(xt,{quote:s.data})]}))}function x(S){const C="Unable to get price quote";try{if(S.error.code==="MINIMUM_PURCHASE_AMOUNT"){const I=S.error;return[`Minimum purchase amount is $${I.data.minimumAmountUSDCents/100}`,`Requested amount is $${I.data.requestedAmountUSDCents/100}`]}}catch{}return[C]}const b=!s.data;return r(d,{px:"lg",flex:"column",gap:"md",children:[r("div",{children:[t(At,{isLoading:s.isLoading,value:s.data?.fromCurrencyWithFees.amount,client:i,currency:w,onSelectCurrency:m}),t(ke,{quoteIsLoading:s.isLoading,estimatedSeconds:s.data?.estimatedDurationSeconds,onViewFees:E})]}),s.error&&t("div",{children:x(s.error).map(S=>t(y,{color:"danger",size:"sm",center:!0,multiline:!0,children:S},S))}),t(R,{variant:b?"outline":"accent","data-disabled":b,disabled:b,fullWidth:!0,onClick:T,gap:"xs",children:s.isLoading?r(W,{children:[t(ne,{size:"sm",color:"accentText"}),"Getting price quote"]}):"Continue"})]})}function $t(e){const n=oe(e.buyForTx.tx.chain);return r(d,{children:[t(l,{y:"xs"}),r(d,{flex:"row",style:{justifyContent:"space-between"},children:[t(y,{size:"sm",children:"Amount Needed"}),r(d,{flex:"column",style:{alignItems:"flex-end"},children:[r(d,{flex:"row",gap:"xs",center:"y",children:[r(y,{color:"primaryText",size:"sm",children:[e.amountNeeded," ",e.buyForTx.tokenSymbol]}),t(Y,{chain:e.buyForTx.tx.chain,client:e.client,size:"sm",token:H})]}),t(l,{y:"xxs"}),n.data?r(y,{size:"sm",children:[" ",n.data.name]}):t(D,{height:p.sm,width:"50px"})]})]}),t(l,{y:"md"}),t(Z,{}),t(l,{y:"md"}),r(d,{flex:"row",style:{justifyContent:"space-between"},children:[t(y,{size:"sm",children:"Your Balance"}),r(d,{flex:"row",gap:"xs",children:[r(y,{color:"primaryText",size:"sm",children:[O(Number(K(e.buyForTx.balance)),4)," ",e.buyForTx.tokenSymbol]}),t(Y,{chain:e.buyForTx.tx.chain,client:e.client,size:"sm",token:H})]})]}),t(l,{y:"md"}),t(Z,{}),t(l,{y:"lg"}),t(y,{center:!0,size:"sm",children:"Purchase"}),t(l,{y:"xxs"})]})}function fe(e,n,a){const o={},i=n.buyWithFiat===!1,c=n.buyWithCrypto===!1;for(const u of e)o[u.chain.id]=u.tokens.filter(f=>f.buyWithCryptoEnabled&&f.buyWithFiatEnabled?!0:!(!f.buyWithCryptoEnabled&&i||!f.buyWithFiatEnabled&&c));if(a)for(const u in a){const f=Number(u),m=a[f];m&&(o[f]=m)}return o}function ye(e){return t(ht,{client:e.client,connectLocale:e.connectLocale,showTabs:!1,onBack:e.showMainScreen,chains:e.chains,closeModal:e.showMainScreen,networkSelector:{renderChain(n){return t(ft,{chain:n.chain,confirming:!1,switchingFailed:!1,onClick:()=>{e.setChain(n.chain),e.showMainScreen()},client:e.client,connectLocale:e.connectLocale})}}})}export{jt as default};
