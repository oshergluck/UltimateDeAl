import{e3 as _,e4 as S,e5 as L,e6 as q,dU as v,dV as g,e7 as x,e8 as H,y as W,e9 as m,dX as k,dW as C,dY as F,ea as E,eb as V,cH as Q,dZ as J,d_ as $,d$ as z,e0 as Y,e1 as B,e2 as K}from"./index.a890a1de.js";class X extends _{constructor({body:t,error:a,url:n}){super("RPC Request failed.",{cause:a,details:a.message,metaMessages:[`URL: ${S(n)}`,`Request body: ${L(t)}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=a.code}}const Z=-1;class G extends _{constructor(t,{code:a,docsPath:n,metaMessages:s,shortMessage:i}){super(i,{cause:t,docsPath:n,metaMessages:s||t?.metaMessages}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=t.name,this.code=t instanceof X?t.code:a??Z}}class O extends G{constructor(t,a){super(t,a),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ProviderRpcError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=a.data}}class b extends O{constructor(t){super(t,{code:b.code,shortMessage:"User rejected the request."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UserRejectedRequestError"})}}Object.defineProperty(b,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class y extends O{constructor(t){super(t,{code:y.code,shortMessage:"An error occurred when attempting to switch chain."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SwitchChainError"})}}Object.defineProperty(y,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const ee="08c4b07e3ad25f1a27c14a4e8cecb6f0",R="eip155",P="wallet_addEthereumChain",ne=!0,w={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};function oe(e){return e.id==="walletConnect"}async function de(e,t,a,n,s){const i=await U(e,a,s),c=e.walletConnect;let{onDisplayUri:r}=c||{};if(!r&&s){const f=await q(a);r=N=>{const I=f.mobile.native||f.mobile.universal;if(!I)throw new Error("No app url found for wallet connect to redirect to.");const j=V(I,N).redirect;s(j)}}r&&i.events.addListener("display_uri",r);const{rpcMap:o,chainsToRequest:l}=A({client:e.client,chain:e.chain,optionalChains:e.walletConnect?.optionalChains});i.session&&await i.connect({...c?.pairingTopic?{pairingTopic:c?.pairingTopic}:{},optionalChains:l,chains:e.chain?[e.chain.id]:l.length>0?[l[0]]:[1],rpcMap:o}),T(l,n);const d=(await i.enable())[0];if(!d)throw new Error("No accounts found on provider.");const h=v(i.chainId),p=e.chain&&e.chain.id===h?e.chain:g(h);if(e){const f={optionalChains:e.walletConnect?.optionalChains,chain:e.chain,pairingTopic:e.walletConnect?.pairingTopic};n&&x(n,a,f)}return c?.onDisplayUri&&i.events.removeListener("display_uri",c.onDisplayUri),D(d,p,i,t,n)}async function le(e,t,a,n,s){const i=n?await H(n,a):null,c=await U(i?{chain:i.chain,client:e.client,walletConnect:{pairingTopic:i.pairingTopic,optionalChains:i.optionalChains}}:{client:e.client,walletConnect:{}},a,s,!0),r=c.accounts[0];if(!r)throw new Error("No accounts found on provider.");const o=v(c.chainId),l=e.chain&&e.chain.id===o?e.chain:g(o);return D(r,l,c,t,n)}async function U(e,t,a,n=!1){const s=await q(t),i=e.walletConnect,{EthereumProvider:c,OPTIONAL_EVENTS:r,OPTIONAL_METHODS:o}=await W(()=>import("./index.es.7d37cdc2.js"),["assets/index.es.7d37cdc2.js","assets/index.a890a1de.js","assets/index.999128e1.css"]),{rpcMap:l,chainsToRequest:u}=A({client:e.client,chain:e.chain,optionalChains:e.walletConnect?.optionalChains}),d=await c.init({showQrModal:a?!1:i?.showQrModal===void 0?ne:i.showQrModal,projectId:i?.projectId||ee,optionalMethods:o,optionalEvents:r,optionalChains:u,chains:e.chain?[e.chain.id]:u.length>0?[u[0]]:[1],metadata:{name:i?.appMetadata?.name||m().name,description:i?.appMetadata?.description||m().description,url:i?.appMetadata?.url||m().url,icons:[i?.appMetadata?.logoUrl||m().logoUrl]},rpcMap:l,qrModalOptions:i?.qrModalOptions,disableProviderPing:!0});if(d.events.setMaxListeners(Number.POSITIVE_INFINITY),n||d.session&&await d.disconnect(),t!=="walletConnect"){let h=function(){const p=d.session?.peer?.metadata?.redirect?.native||s.mobile.native||s.mobile.universal;a&&p&&a(p)};d.signer.client.on("session_request_sent",h),d.events.addListener("disconnect",()=>{d.signer.client.off("session_request_sent",h)})}return d}function M(e,t){return{address:t,async sendTransaction(n){return{transactionHash:await e.request({method:"eth_sendTransaction",params:[{gas:n.gas?C(n.gas):void 0,value:n.value?C(n.value):void 0,from:this.address,to:n.to,data:n.data}]})}},async signMessage({message:n}){const s=(()=>typeof n=="string"?J(n):n.raw instanceof Uint8Array?$(n.raw):n.raw)();return e.request({method:"personal_sign",params:[s,this.address]})},async signTypedData(n){const s=z(n),{domain:i,message:c,primaryType:r}=s,o={EIP712Domain:Y({domain:i}),...s.types};B({domain:i,message:c,primaryType:r,types:o});const l=K({domain:i??{},message:c,primaryType:r,types:o});return await e.request({method:"eth_signTypedData_v4",params:[this.address,l]})}}}function D(e,t,a,n,s){const i=M(a,e);async function c(){a.removeListener("accountsChanged",o),a.removeListener("chainChanged",l),a.removeListener("disconnect",r),await a.disconnect()}function r(){T([],s),s?.removeItem(w.lastUsedChainId),c(),n.emit("disconnect",void 0)}function o(u){if(u[0]){const d=M(a,Q(u[0]));n.emit("accountChanged",d),n.emit("accountsChanged",u)}else r()}function l(u){const d=g(v(u));n.emit("chainChanged",d),s?.setItem(w.lastUsedChainId,String(u))}return a.on("accountsChanged",o),a.on("chainChanged",l),a.on("disconnect",r),a.on("session_delete",r),[i,t,c,u=>ie(a,u,s)]}function ae(e){return e.session?.namespaces[R]?.methods||[]}function te(e){return e.session?.namespaces[R]?.chains?.map(a=>Number.parseInt(a.split(":")[1]||""))??[]}async function ie(e,t,a){const n=t.id;try{const s=te(e),i=ae(e);if(!s.includes(n)&&i.includes(P)){const r=await k(t);await e.request({method:P,params:[{chainId:C(r.chainId),chainName:r.name,nativeCurrency:r.nativeCurrency,rpcUrls:F(r),blockExplorerUrls:t.blockExplorers?.slice(0,1)||r.explorers?.slice(0,1)||[]}]});const o=await se(a);o.push(n),T(o,a)}await e.request({method:"wallet_switchEthereumChain",params:[{chainId:C(n)}]})}catch(s){const i=typeof s=="string"?s:s?.message;throw/user rejected request/i.test(i)?new b(s):new y(s)}}function T(e,t){t?.setItem(w.requestedChains,JSON.stringify(e))}async function se(e){const t=await e.getItem(w.requestedChains);return t?JSON.parse(t):[]}function A(e){const t={};e.chain&&(t[e.chain.id]=E({chain:e.chain,client:e.client}));const a=(e?.optionalChains||[]).slice(0,10);for(const i of a)t[i.id]=E({chain:i,client:e.client});const n=a.map(i=>i.id)||[],s=e.chain?[e.chain.id,...n]:n.length>0?n:[1];return!e.chain&&a.length===0&&(t[1]=g(1).rpc),{rpcMap:t,chainsToRequest:s}}export{le as autoConnectWC,de as connectWC,oe as isWalletConnect};
